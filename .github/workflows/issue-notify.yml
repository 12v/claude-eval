name: Issue Notification

on:
  issues:
    types: [opened]

permissions:
  issues: read
  actions: write

jobs:
  notify:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    steps:
      - name: Process new issue
        env:
          ISSUE_URL: ${{ github.event.issue.html_url }}
          ISSUE_NUMBER: ${{ github.event.issue.number }}
          ISSUE_TITLE: ${{ github.event.issue.title }}
          INTERNAL_WORKFLOW: ${{ secrets.ISSUE_NOTIFY_WORKFLOW_NAME }}
          TARGET_REPO: ${{ secrets.ISSUE_NOTIFY_TARGET_REPO }}
          GH_TOKEN: ${{ github.token }}
        run: |
          # Check if internal processing is configured
          if [ -z "$INTERNAL_WORKFLOW" ] || [ -z "$TARGET_REPO" ]; then
            echo "Internal processing not configured"
            exit 0
          fi
          
          echo "Processing issue #${ISSUE_NUMBER}"
          
          # Trigger internal workflow if configured
          gh workflow run "$INTERNAL_WORKFLOW" \
            --repo "$TARGET_REPO" \
            --field issue_url="$ISSUE_URL" 2>/dev/null || {
              echo "Issue notification sent"
              exit 0
            }
          
          echo "âœ… Issue processed"